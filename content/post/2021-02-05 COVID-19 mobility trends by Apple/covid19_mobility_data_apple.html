---
date: "2021-02-05"
title: "COVID-19 mobility trends by Apple"
---



<p>Challenge 1: Learn to use basic data visualisation with tidyverse
Challenge 2: Get to know Apple’s COVID-19 mobility trend data</p>
<p>During 2020 several new R-packages providing data relating to the global pandemic COVID-19 were released. One of these is <a href="https://covid19.apple.com/mobility"><strong>Apple’s mobility trend data</strong></a>, which the tech-giant released to the public in March 2020. (Shortly after <a href="https://www.google.com/covid19/mobility/"><strong>Google</strong></a> also released their mobility data which I will dive into in an upcoming post).</p>
<p>Most of my previous coding experience has mostly been done in order to manipulate and wrangle data or arrive to a numeric result produced to an csv-file that was to serve as in input to another program. Hence, my expereince of visualising data (nicely) for presentations or reports is close to non-existent. The challenge for me in this post is to learn to visualize data using <a href="https://rmarkdown.rstudio.com/"><strong>RMarkdown</strong></a> and the package <a href="https://www.tidyverse.org/"><strong>tidyverse</strong></a>.</p>
<p>The mobility data from both Apple and Google is available in the R <a href="https://github.com/Covid19R/covid19mobility"><strong>covid19mobility</strong></a> package. Apple’s data is published daily and “reflects requests for directions in Apple Maps” since 13 January 2020 for countries, cities and subregions.</p>
<p>I start by loading the data:</p>
<pre class="r"><code># Load Apple&#39;s country and city data and add it to a data frame
df_apple_country &lt;- refresh_covid19mobility_apple_country()
df_apple_city &lt;- refresh_covid19mobility_apple_city()

# Use the code below to access Apple&#39;s mobilty trend data for subregions of countries. 
# I will be using the data on subregions in a future post.
# df_apple_subregion &lt;- refresh_covid19mobility_apple_subregion()</code></pre>
<p>Then I assign values to varaibles in order to faciitate the process of altering the city or country of interest:</p>
<pre class="r"><code># Assign the country/city/region you are interested in to variables
country &lt;- &quot;Sweden&quot;
countries &lt;- c(country, &quot;Norway&quot;, &quot;Denmark&quot;)
cities &lt;- c(&quot;Stockholm&quot;, &quot;Oslo&quot;, &quot;Copenhagen&quot;)

# Assign the start and end date of the data to variables for use in captions
start &lt;- as.Date(min(df_apple_country$date))
end &lt;- as.Date(max(df_apple_country$date))</code></pre>
<p>Next, I create a custom theme that I want to apply to all plots:</p>
<pre class="r"><code>my_text_theme &lt;- theme(
  plot.title = element_text(family = &quot;Helvetica&quot;, face = &quot;bold&quot;, size = (15)),
  plot.subtitle = element_text(family = &quot;Helvetica&quot;, size = (10)),
  legend.position = &quot;top&quot;,
  legend.title = element_blank(),
  legend.text = element_text(family = &quot;Helvetica&quot;, colour=&quot;black&quot;, size = (10)),
  axis.text = element_text(family = &quot;Helvetica&quot;, colour = &quot;black&quot;, size = (10)))

theme_set(my_text_theme)</code></pre>
<p>The data is very easy to use. First, I filter out mobility trend data for the country Sweden. Then I visualise Apple’s three mobility indicators (driving, public transport and walking) for Sweden in a plot:</p>
<pre class="r"><code>plot1 &lt;- df_apple_country %&gt;%
  filter(location %in% country) %&gt;%
  mutate(mobility_indicator = case_when(
    str_detect(data_type, &quot;driving&quot;) ~ &quot;Driving&quot;,
    str_detect(data_type, &quot;transit&quot;) ~ &quot;Public transport&quot;,
    str_detect(data_type, &quot;walking&quot;) ~ &quot;Walking&quot;)
    ) %&gt;%
  arrange(mobility_indicator) %&gt;%
  
  ggplot(aes(x = date, y = (value/100-1)*100, color = mobility_indicator)) +
  geom_line() +
  theme_bw() +
  my_text_theme +
  
  scale_x_date(expand = c(0,0), labels = date_format(&quot;%d %b %Y&quot;)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_color_manual(values=c(&quot;#003f5c&quot;, &quot;#bc5090&quot;, &quot;#ffa600&quot;)) +
 
  labs(
    title = paste(&quot;Apple&#39;s mobility index for&quot;, country),
    subtitle = paste(&quot;Percentage change in routing requests since&quot;, as.character(start, &quot;%d %B %Y&quot;)),
    caption = &quot;Source: Apple, https://covid19.apple.com/mobility&quot;,
    x = &quot;&quot;,
    y = &quot;&quot;
  )

plot1</code></pre>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Next, I want to compare the mobility indicators for Sweden to those of neighboring Denmark and Norway by facetting the plot:</p>
<pre class="r"><code>plot2 &lt;- df_apple_country %&gt;%
  filter(location %in% countries) %&gt;%
  mutate(mobility_indicator = case_when(
    str_detect(data_type, &quot;driving&quot;) ~ &quot;Driving&quot;,
    str_detect(data_type, &quot;transit&quot;) ~ &quot;Public transport&quot;,
    str_detect(data_type, &quot;walking&quot;) ~ &quot;Walking&quot;)
    ) %&gt;%
  arrange(mobility_indicator) %&gt;%
  
  ggplot(aes(x = date, y = (value/100 -1)*100, color = mobility_indicator)) +
  geom_line() +
  theme_bw() +
  my_text_theme +
  
  scale_x_date(expand = c(0,0), labels = date_format(&quot;%b %y&quot;)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_color_manual(values=c(&quot;#003f5c&quot;, &quot;#bc5090&quot;, &quot;#ffa600&quot;)) +

  labs(
    title = paste(&quot;Comparing Apple&#39;s mobility index for&quot;, countries[1], &quot;to other countries&quot;),
    subtitle = paste(&quot;Percentage change in routing requests since&quot;, as.character(start, &quot;%d %B %Y&quot;)),
    caption = &quot;Source: Apple, https://covid19.apple.com/mobility&quot;,
    x = &quot;&quot;,
    y = &quot;&quot;
  ) + 
  
  facet_grid(rows = vars(location)) + #facet by rows
  theme(strip.placement = &quot;outside&quot;)

plot2</code></pre>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Next, instead of comparing three plots for each country, I want to compare three plots for each mobility indicator. I also facet by columns (instead of by rows as above):</p>
<pre class="r"><code>plot3 &lt;- df_apple_country %&gt;%
  filter(location %in% countries) %&gt;%
  mutate(mobility_indicator = case_when(
    str_detect(data_type, &quot;driving&quot;) ~ &quot;Driving&quot;,
    str_detect(data_type, &quot;transit&quot;) ~ &quot;Public transport&quot;,
    str_detect(data_type, &quot;walking&quot;) ~ &quot;Walking&quot;)
    ) %&gt;%
  arrange(mobility_indicator) %&gt;%
  
  ggplot(aes(x = date, y = (value/100 -1)*100, color = location)) +  # I change the color to &#39;location&#39;
  geom_line() +
  theme_bw() +
  my_text_theme +
  
  scale_x_date(expand = c(0,0), labels = date_format(&quot;%b %y&quot;)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_color_manual(values=c(&quot;#003f5c&quot;, &quot;#bc5090&quot;, &quot;#ffa600&quot;)) +

  labs(
    title = paste(&quot;Comparing Apple&#39;s mobility index for&quot;, countries[1], &quot;to other countries&quot;),
    subtitle = paste(&quot;Percentage change in routing requests since&quot;, as.character(start, &quot;%d %B %Y&quot;)),
    caption = &quot;Source: Apple, https://covid19.apple.com/mobility&quot;,
    x = &quot;&quot;,
    y = &quot;&quot;
  ) + 
  
  facet_grid(cols = vars(mobility_indicator)) + #facet by columns
  theme(strip.placement = &quot;outside&quot;)

plot3</code></pre>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Next, I am curious to see whether the big uptick in driving during the summer of 2020 in Sweden was concentrated to Sweden’s capital Stockholm:</p>
<pre class="r"><code>plot4 &lt;- df_apple_city %&gt;%
  filter(location %in% cities[1]) %&gt;%
  mutate(mobility_indicator = case_when(
    str_detect(data_type, &quot;driving&quot;) ~ &quot;Driving&quot;,
    str_detect(data_type, &quot;transit&quot;) ~ &quot;Public transport&quot;,
    str_detect(data_type, &quot;walking&quot;) ~ &quot;Walking&quot;)
    ) %&gt;%
  arrange(mobility_indicator) %&gt;%
  
  ggplot(aes(x = date, y = (value/100-1)*100, color = mobility_indicator)) +
  geom_line() +
  theme_bw() +
  my_text_theme +
  
  scale_x_date(expand = c(0,0), labels = date_format(&quot;%d %b %Y&quot;)) +
  scale_y_continuous(expand = c(0,0)) +
  scale_color_manual(values=c(&quot;#003f5c&quot;, &quot;#bc5090&quot;, &quot;#ffa600&quot;)) +
  
  labs(
    title = paste(&quot;Apple&#39;s mobility index for&quot;, cities[1]),
    subtitle = paste(&quot;Percentage change in routing requests since&quot;, as.character(start, &quot;%d %B %Y&quot;)),
    caption = &quot;Source: Apple, https://covid19.apple.com/mobility&quot;,
    x = &quot;&quot;,
    y = &quot;&quot;
  )

plot4</code></pre>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The plot shows no uptick in the mobility indicator “driving” in Stockholm, so the big lift must have happened in the rest of the country. Next I want to compare Stockholm to the capitals of Denmark (Copenhagen) and Norway (Oslo):</p>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Next, I want to visualise both all three capitals and countries in one single plot:</p>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/comparison%20capitals%20and%20countries-1.png" width="672" /></p>
<p>And last but not least, I want to compare the mobility trend indicators for Sweden to the three biggest cities in the country: 1. <a href="https://en.wikipedia.org/wiki/Stockholm"><strong>Stockholm</strong></a>, 2. <a href="https://en.wikipedia.org/wiki/Gothenburg"><strong>Gothenburg</strong></a> and 3. <a href="https://en.wikipedia.org/wiki/Malm%C3%B6"><strong>Malmö</strong></a>. Oddly, the city Malmö is spelled using the Swedish letter “ö” in the Apple data, while Gothenburg (in Swedish: Göteborg) is spelled in English “Gothenburg”. Interesting, I wonder why that is?</p>
<p><img src="/post/2021-02-05 COVID-19 mobility trends by Apple/covid19_mobility_data_apple_files/figure-html/comparison%20sweden%20internal-1.png" width="672" /></p>
<p>That was all for now! Omg, there were so many more possibilities available for tweaking plots when using ggplot2 in tidyverse than I expected. I really had to spend quite some time online reading documentation and checking examples. The possibilites are truely immense so please see the above as a glimpse into the world of tidy! I can warmly recommend the folowing page on the website <a href="https://datacarpentry.org/R-ecology-lesson/04-visualization-ggplot2"><strong>datacarpentry.org</strong></a> that I found particularly useful for the type of data used in this post.</p>
